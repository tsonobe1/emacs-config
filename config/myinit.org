#+TITLE: Emacs Configuration
* env
** emacs
  #+BEGIN_SRC emacs-lisp
    ;; Emacs å…¨ä½“ã®è¨€èªç’°å¢ƒã‚’æ—¥æœ¬èªã«è¨­å®š
    (set-language-environment "Japanese")

    ;; ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’ UTF-8 ã«è¨­å®š
    (prefer-coding-system 'utf-8)

    ;; æ›œæ—¥ãƒ»æœˆåãªã©ã®ãƒ­ã‚±ãƒ¼ãƒ«è¡¨è¨˜ã‚’è‹±èªï¼ˆC ãƒ­ã‚±ãƒ¼ãƒ«ï¼‰ã«ã™ã‚‹
    (setq system-time-locale "C")
    (set-locale-environment "en_US.UTF-8")

    ;; ãƒãƒƒãƒ•ã‚¡ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’ UTF-8 ã«è¨­å®š
    (set-default 'buffer-file-coding-system 'utf-8)

    ;; Emacs å…¨ä½“ã§å¸¸ã«è¡Œç•ªå·ã‚’è¡¨ç¤º
    (global-display-line-numbers-mode t)

    ;; Emacs ãŒ .elï¼ˆã‚½ãƒ¼ã‚¹ï¼‰ã¨ .elcï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆã¿ãƒã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ï¼‰ã®ä¸¡æ–¹ã‚’è¦‹ã¤ã‘ãŸã¨ãã€è‡ªå‹•çš„ã«ã‚½ãƒ¼ã‚¹ã®ã»ã†ãŒæ–°ã„æ–¹ã‚’èª­ã‚€
    (setq load-prefer-newer t)

    ;; -------------------------------------------------------------
    ;; which-keyï¼šã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è£œåŠ©ï¼ˆæ¬¡ã«æŠ¼ã™ã¹ãã‚­ãƒ¼ã‚’æ•™ãˆã¦ãã‚Œã‚‹ï¼‰
    ;; -------------------------------------------------------------
    (use-package which-key 
      :diminish which-key-mode ;; ãƒ¢ãƒ¼ãƒ‰ãƒ©ã‚¤ãƒ³è¡¨ç¤ºã‚’ç°¡ç´ åŒ–
      :hook (after-init . which-key-mode)) ;; Emacsèµ·å‹•å¾Œã«è‡ªå‹•æœ‰åŠ¹åŒ–

    ;; -------------------------------------------------------------
    ;; amxï¼šM-x å®Ÿè¡Œå±¥æ­´ã‚’å¼·åŒ–ï¼ˆsmexã®å¾Œç¶™ï¼‰
    ;; -------------------------------------------------------------
    (use-package amx)
  #+END_SRC
** package
  #+BEGIN_SRC emacs-lisp
    ;; ---------------------------------------------
    ;; ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã®åˆæœŸè¨­å®š
    ;; ---------------------------------------------

    ;; Emacs ã®çµ„ã¿è¾¼ã¿ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã‚’æœ‰åŠ¹ã«ã™ã‚‹
    (require 'package)

    ;; ä½¿ç”¨ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼ˆãƒªãƒã‚¸ãƒˆãƒªï¼‰ã‚’è¨­å®š
    ;; MELPA ã¯å¤šæ•°ã®æœ€æ–°ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å«ã‚“ã§ã„ã‚‹ã®ã§ç‰¹ã«é‡è¦
    (setq package-archives
	  '(("gnu" . "https://elpa.gnu.org/packages/")
	    ("melpa" . "https://melpa.org/packages/")))

    ;; ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ï¼ˆå¿…ãš package-archives è¨­å®šå¾Œã«å‘¼ã¶ï¼‰
    (package-initialize)

    ;; `org` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ˜ç¤ºçš„ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    (package-install 'org)

    ;; ---------------------------------------------
    ;; gnuplot ã®èª­ã¿è¾¼ã¿
    ;; ---------------------------------------------

    ;; `gnuplot.el` ã‚’èª­ã¿è¾¼ã‚€ï¼ˆæç”»ã‚³ãƒãƒ³ãƒ‰é€£æºç”¨ï¼‰
    ;; å¿…è¦ã«å¿œã˜ã¦ `gnuplot-mode` ã‚„ `org-babel-gnuplot` ã‚’ä½µç”¨
    (require 'gnuplot)
  #+END_SRC
  #+begin_src emacs-lisp
    ;; ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¸€è¦§ã‚’æ›´æ–°ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    (unless (package-installed-p 'use-package)
      (package-refresh-contents)
      (package-install 'use-package))

    (require 'use-package)
    ;; ä»¥é™ã§use-package ã«è¨­å®šã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å ´åˆã€è‡ªå‹•ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
    (setq use-package-always-ensure t)

    (setq package-enable-at-startup nil)

    ;; -------------------------------------------------------------
    ;; straight.el ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆWindows ä»¥å¤–ã®ç’°å¢ƒã§ã®ã¿å®Ÿè¡Œï¼‰
    ;; -------------------------------------------------------------
    (unless (eq system-type 'windows-nt)
      (defvar bootstrap-version)
      (let ((bootstrap-file
	     (expand-file-name "straight/repos/straight.el/bootstrap.el" user-emacs-directory))
	    (bootstrap-version 7))

	;; bootstrap.el ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰å–å¾—ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
	(unless (file-exists-p bootstrap-file)
	  (with-current-buffer
	      (url-retrieve-synchronously
	       "https://raw.githubusercontent.com/radian-software/straight.el/develop/install.el"
	       'silent 'inhibit-cookies)
	    (goto-char (point-max))
	    (eval-print-last-sexp)))

	;; straight.el ã‚’ãƒ­ãƒ¼ãƒ‰
	(load bootstrap-file nil 'nomessage)))
    
  #+end_src
* org-mode
** babel
  #+BEGIN_SRC emacs-lisp
    ;; org-tempo ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ã§ã€<s TAB ãªã©ã®ãƒ†ãƒ³ãƒ—ãƒ¬å±•é–‹ãŒæœ‰åŠ¹ã«ãªã‚‹
    (require 'org-tempo)

    ;; Babelã®è¨­å®š
    ;; Python å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ã®ãƒ‘ã‚¹ã‚’ OS ã«ã‚ˆã£ã¦åˆ‡ã‚Šæ›¿ãˆã‚‹
    ;; Windows ã®å ´åˆã¨ macOS/Linux ã®å ´åˆã§åˆ¥ã®ä»®æƒ³ç’°å¢ƒã‚’æŒ‡å®š
    (setq org-babel-python-command
	  (if (eq system-type 'windows-nt)
	      "C:/emacs-org/env/bin/python"
	    "/Users/tsonobe/.emacs.d/env/bin/python"))

    ;; Org Babel å®Ÿè¡Œæ™‚ã®ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç„¡åŠ¹ã«ã™ã‚‹
    (setq org-confirm-babel-evaluate nil)

    ;; é•·ã„è¡Œã‚’è‡ªå‹•æŠ˜ã‚Šè¿”ã—ï¼ˆtruncated: nil ã«ã™ã‚‹ã¨æŠ˜ã‚Šè¿”ã—ï¼‰
    (setq org-startup-truncated nil)

    ;; org-babel ã«ã‚ˆã£ã¦å®Ÿè¡Œå¯èƒ½ãªè¨€èªã‚’ç™»éŒ²
    (org-babel-do-load-languages
     'org-babel-load-languages
     '((python . t) ; Python
       (js . t)     ; JavaScript
       (C . t)      ; C
       (shell . t)  ; sh
       (css . t)    ; css
       (sql . t)))  ; sql

    ;; JavaScript å®Ÿè¡Œã®ãŸã‚ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã‚€
    (require 'ob-js)

    ;; js ã‚’ tangleï¼ˆã‚³ãƒ¼ãƒ‰æŠ½å‡ºï¼‰ã—ãŸéš›ã®æ‹¡å¼µå­ã‚’ .js ã«ã™ã‚‹
    (add-to-list 'org-babel-tangle-lang-exts '("js" . "js"))

    ;; Cç”¨ã® Babel ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã‚€
    (require 'ob-C)

    ;; dockerfile-modeã®è¨­å®š
    (use-package dockerfile-mode
      :ensure t
      :mode ("Dockerfile\\'" . dockerfile-mode))

    ;; markdown-modeã®è¨­å®š
    (use-package markdown-mode
      :ensure t
      :mode ("\\.md\\'" . markdown-mode)
      :init (setq markdown-command "multimarkdown"))

    ;; yaml-modeã®è¨­å®š
    (use-package yaml-mode
      :ensure t
      :mode ("\\.yml\\'" . yaml-mode)
      :mode ("\\.yaml\\'" . yaml-mode))
  #+END_SRC
** truncate-line
  #+begin_src emacs-lisp
    ;; ---------------------------------------------
    ;; è¡Œã®æŠ˜ã‚Šè¿”ã—è¡¨ç¤ºã‚’ãƒˆã‚°ãƒ«ã™ã‚‹é–¢æ•°ã¨ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰
    ;; ---------------------------------------------
    ;; nil â†’ æŠ˜ã‚Šè¿”ã™ã€t â†’ æŠ˜ã‚Šè¿”ã•ãšã«å³ã«æµã™
    (defun my-toggle-truncate-lines ()
      "Toggle truncate-lines between nil and t."
      (interactive)
      (setq truncate-lines (not truncate-lines))
      (recenter))

    ;; org-mode ã®ãƒãƒƒãƒ•ã‚¡ã§ C-c t ã«ã“ã®ãƒˆã‚°ãƒ«é–¢æ•°ã‚’ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹
    (add-hook 'org-mode-hook
	      (lambda ()
		(local-set-key (kbd "C-c t") 'my-toggle-truncate-lines)))
  #+end_src
** mermaid
#+BEGIN_SRC emacs-lisp
  (unless (package-installed-p 'ob-mermaid)
    (package-refresh-contents)
    (package-install 'ob-mermaid))

  (if (eq system-type 'windows-nt)
      ;; Windowsã®å ´åˆ
      (progn
	(setq ob-mermaid-cli-path "C:/scoop/apps/nodejs16/current/bin/mmdc.cmd"))
    ;; Macã®å ´åˆ
    (progn
      (setq ob-mermaid-cli-path "/Users/tsonobe/.nodebrew/node/v22.3.0/bin/mmdc")))

  (org-babel-do-load-languages
   'org-babel-load-languages
   '((mermaid . t)
     (scheme . t)))
#+END_SRC
** flycheck
#+BEGIN_SRC emacs-lisp
  ;; ---------------------------------------------------
  ;; Flycheck + textlint ã‚’ä½¿ã£ãŸè‡ªç„¶è¨€èªæ–‡æ³•ãƒã‚§ãƒƒã‚¯è¨­å®š
  ;; ---------------------------------------------------

  ;; Flycheckï¼ˆæ§‹æ–‡ãƒã‚§ãƒƒã‚¯ãƒ„ãƒ¼ãƒ«ï¼‰ãŒæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãªã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
  (unless (package-installed-p 'flycheck)
    (package-refresh-contents)
    (package-install 'flycheck))

  ;; textlint ã®å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’ OS ã«å¿œã˜ã¦åˆ‡ã‚Šæ›¿ãˆã‚‹
  (if (eq system-type 'windows-nt)
      ;; Windowsã®å ´åˆ
      (progn
	(setq flycheck-textlint-executable "C:/scoop/apps/nodejs16/current/bin/textlint.cmd") ;; textlintã®ãƒ‘ã‚¹ã‚’æŒ‡å®š
	(setq flycheck-textlint-config "C:/emacs-org/.textlintrc.json")) ;; è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
    ;; Macã®å ´åˆ
    (progn
      (setq flycheck-textlint-executable "/Users/tsonobe/.nodebrew/node/v22.3.0/bin/textlint") ;; textlintã®ãƒ‘ã‚¹ã‚’æŒ‡å®šï¼ˆHomebrewãªã©ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸå ´åˆï¼‰
      (setq flycheck-textlint-config "/Users/tsonobe/.emacs.d/.textlintrc.json"))) ;; è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹

  ;; textlint ã‚’ Flycheck ã®ãƒã‚§ãƒƒã‚«ãƒ¼ã¨ã—ã¦å®šç¾©ã™ã‚‹
  (flycheck-define-checker textlint
    "A linter using textlint."
    :command ("textlint" "--format" "unix" 
	      source-inplace) ; ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ç›´æ¥ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
    :error-patterns
    ((warning line-start (file-name) ":" line ":" column ": "
	      (id (one-or-more (not (any " ")))) ; ã‚¨ãƒ©ãƒ¼ID
	      (message (one-or-more not-newline)
		       (zero-or-more "\n" (any " ") (one-or-more not-newline)))
	      line-end))
    :modes (text-mode markdown-mode gfm-mode org-mode web-mode)) ; å¯¾å¿œãƒ¢ãƒ¼ãƒ‰

  ;; å®šç¾©ã—ãŸ textlint ãƒã‚§ãƒƒã‚«ãƒ¼ã‚’ Flycheck ã«è¿½åŠ 
  (add-to-list 'flycheck-checkers 'textlint)

  ;; textlint ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ã§ flycheck-mode ã‚’è‡ªå‹•ã‚ªãƒ³
  (dolist (hook '(gfm-mode-hook markdown-mode-hook org-mode-hook))
    (add-hook hook 'flycheck-mode))

  ;; ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒã‚§ãƒƒã‚«ãƒ¼ã‚’ textlint ã®ã¿ã«è¨­å®šï¼ˆä»–ã® checker ã‚’ç„¡åŠ¹åŒ–ï¼‰
  (setq flycheck-checkers '(textlint))

  ;; ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Œã°ãƒŸãƒ‹ãƒãƒƒãƒ•ã‚¡ã«è¡¨ç¤ºï¼ˆã‚¨ãƒ©ãƒ¼ãƒªã‚¹ãƒˆãƒãƒƒãƒ•ã‚¡ãŒé–‹ã„ã¦ã„ãªã„æ™‚ï¼‰
  (setq flycheck-display-errors-function #'flycheck-display-error-messages-unless-error-list)

  #+END_SRC
** node
#+BEGIN_SRC emacs-lisp
  (if (eq system-type 'windows-nt)
      ;; Windowsã®å ´åˆ
      (progn
	;; exec-path ã« Node.js ã®ãƒ‘ã‚¹ã‚’è¿½åŠ 
	(setq exec-path (append '("C:/scoop/apps/nodejs16/current" "C:/scoop/apps/nodejs16/current/bin") exec-path))

	;; ç’°å¢ƒå¤‰æ•° PATH ã«ã‚‚è¿½åŠ 
	(setenv "PATH" (concat "C:/scoop/apps/nodejs16/current;C:/scoop/apps/nodejs16/current/bin;" (getenv "PATH"))))

    ;; macOSã®å ´åˆ
    (progn
      ;; exec-path ã« Node.js ã®ãƒ‘ã‚¹ã‚’è¿½åŠ ï¼ˆHomebrewã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸå ´åˆã®ä¾‹ï¼‰
      (setq exec-path (append '("/Users/tsonobe/.nodebrew/current/bin/node") exec-path))

      ;; ç’°å¢ƒå¤‰æ•° PATH ã«ã‚‚è¿½åŠ 
      (setenv "PATH" (concat "/Users/tsonobe/.nodebrew/current/bin/node" (getenv "PATH")))))
#+END_SRC
** todo
#+BEGIN_SRC emacs-lisp
  (setq org-todo-keywords
	'((sequence "TODO(t)" "WAIT(w)" "SAMEDAY(s)" "|" "DONE(d)" "CANCEL(c)")))

  ;; Doneã®æ™‚åˆ»ã‚’è¨˜éŒ²ã™ã‚‹
  (setq org-log-done 'time)
#+END_SRC

** org-roam 
  #+BEGIN_SRC emacs-lisp
    ;; -------------------------------------------------------------
    ;; org-roam ã®å°å…¥ã¨åˆæœŸè¨­å®š
    ;; -------------------------------------------------------------

    ;; org-roam ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
    (unless (package-installed-p 'org-roam)
      (package-refresh-contents)
      (package-install 'org-roam))

    ;; org-roam ã‚’èª­ã¿è¾¼ã‚€
    (require 'org-roam)

    ;; ãƒãƒ¼ãƒˆä¿å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è¨­å®šï¼ˆOS ã«å¿œã˜ã¦åˆ‡ã‚Šæ›¿ãˆï¼‰
    (setq org-roam-directory
	  (file-truename (if (eq system-type 'windows-nt)
			     "C:/emacs-org/org-roam"
			   "~/.emacs.d/org-roam")))

    ;; ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜å…ˆã‚’æŒ‡å®š
    (setq org-roam-db-location
	  (if (eq system-type 'windows-nt)
	      "C:/emacs-org/org-roam/org-roam.db"
	    "~/.emacs.d/org-roam/org-roam.db"))

    ;; org-roam ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŒæœŸã‚’è‡ªå‹•ã§è¡Œã†
    (org-roam-db-autosync-mode)


    ;; -------------------------------------------------------------
    ;; org-roam ã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ï¼ˆä¸»ã« C-c n ã§å§‹ã¾ã‚‹ï¼‰
    ;; -------------------------------------------------------------
    (dolist (key-fn '(("C-c n f" . org-roam-node-find)
		      ("C-c n i" . org-roam-node-insert)
		      ("C-c n t" . org-roam-buffer-toggle)
		      ("C-c n l" . org-roam-buffer-toggle)
		      ("C-c n d" . org-roam-dailies-capture-date)
		      ("C-c n g" . org-roam-graph)
		      ("C-c n a" . org-roam-alias-add)
		      ("C-c n r" . org-roam-ref-add)))
      (global-set-key (kbd (car key-fn)) (cdr key-fn)))

    ;; ä»–ãƒ¢ãƒ¼ãƒ‰ã§ã‚‚è£œå®Œã‚’æœ‰åŠ¹ã«ï¼ˆä¾‹: org-capture ãªã©ï¼‰
    (setq org-roam-completion-everywhere t)

    ;; -------------------------------------------------------------
    ;; org-roam-capture-templates ã®è¨­å®š
    ;; å„ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«ä¿å­˜å ´æ‰€ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«åãƒ»ã‚¿ã‚°ã‚’æŒ‡å®š
    ;; -------------------------------------------------------------
    (setq org-roam-capture-templates
	  '(("d" "default" plain "%?"
	     :target (file+head "%<%Y%m%d%H%M%S>-${slug}.org"
				"#+title: ${title}\n#+date: %<%Y-%m-%d %H:%M:%S>\n")
	     :unnarrowed t)

	    ("n" "knowledge" plain "%?"
	     :target (file+head "knowledge/%<%Y%m%d%H%M%S>-${slug}.org"
				"#+title: ${title}\n#+date: %<%Y-%m-%d %H:%M:%S>\n#+filetags: :knowledge:\n")
	     :unnarrowed t)

	    ("w" "work" plain "%?"
	     :target (file+head "work/%<%Y%m%d%H%M%S>-${slug}.org"
				"#+title: ${title}\n#+date: %<%Y-%m-%d %H:%M:%S>\n#+filetags: :work:\n")
	     :unnarrowed t)

	    ("t" "tool" plain "%?"
	     :target (file+head "tool/%<%Y%m%d%H%M%S>-${slug}.org"
				"#+title: ${title}\n#+date: %<%Y-%m-%d %H:%M:%S>\n#+filetags: :tool:\n")
	     :unnarrowed t)

	    ("r" "recipe" plain "%?"
	     :target (file+head "recipe/%<%Y%m%d%H%M%S>-${slug}.org"
				"#+title: ${title}\n#+date: %<%Y-%m-%d %H:%M:%S>\n#+filetags: :recipe:\n")
1	     :unnarrowed t)

	    ("m" "money" plain "%?"
	     :target (file+head "money/%<%Y%m%d%H%M%S>-${slug}.org"
				"#+title: ${title}\n#+date: %<%Y-%m-%d %H:%M:%S>\n#+filetags: :money:\n")
	     :unnarrowed t)

	    ("c" "discuss" plain "%?"
	     :target (file+head "discuss/%<%Y%m%d%H%M%S>-${slug}.org"
				"#+title: ${title}\n#+date: %<%Y-%m-%d %H:%M:%S>\n#+filetags: :discuss:\n")
	     :unnarrowed t)))

    ;; -------------------------------------------------------------
    ;; org-roam-dailies ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¨­å®šï¼ˆæ—¥å ±ç”¨ï¼‰
    ;; -------------------------------------------------------------
    (setq org-roam-dailies-capture-templates
	  '(("d" "dailies" entry
	     "* %<%Y/%m/%d(%a)>\n* å‹¤å‹™æ™‚é–“\n09:30 ~ 18:30\n* ä½œæ¥­\n\n* æ‰€æ„Ÿ\n\n* æ¬¡æ—¥ã®äºˆå®š\n%?"
	     :target (file+head "%<%Y-%m-%d>.org"
				"#+title: %<%Y-%m-%d>\n#+options: toc:nil\n#+options: author:nil\n#+options: num:nil\n"))))

  #+END_SRC
** org capture
#+BEGIN_SRC emacs-lisp
  ;; org-captureã‚’C-c cã«ãƒã‚¤ãƒ³ãƒ‰
  (global-set-key (kbd "C-c c") 'org-capture)

  ;; Org Captureãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è¨­å®š
  (setq org-capture-templates
	`(("t" "Todo" entry (file+headline ,(if (eq system-type 'windows-nt)
						"C:\\emacs-org\\inbox.org"
					      "~/.emacs.d/inbox.org") "ğŸ“¥ INBOX")
	   "** TODO %?")
	  ("w" "Work Todo" entry (file+headline ,(if (eq system-type 'windows-nt)
						     "C:\\emacs-org\\inbox.org"
						   "~/.emacs.d/inbox.org") "ğŸ“¥ INBOX")
	   "** TODO %?  :work:")
	  ("p" "Private Todo" entry (file+headline ,(if (eq system-type 'windows-nt)
							"C:\\emacs-org\\inbox.org"
						      "~/.emacs.d/inbox.org") "ğŸ“¥ INBOX")
	   "** TODO %?  :private:")
	  ("s" "Someday" entry (file+headline ,(if (eq system-type 'windows-nt)
						   "C:\\emacs-org\\inbox.org"
						 "~/.emacs.d/inbox.org") "ğŸ¤” Someday")
	   "** SAMEDAY %?")))
#+END_SRC

** org agenda
#+BEGIN_SRC emacs-lisp
  ;; ---------------------------------------------------------
  ;; Org Agenda ã®åŸºæœ¬è¨­å®š
  ;; ---------------------------------------------------------
  
  ;; org-agendaã‚’C-c aã«ãƒã‚¤ãƒ³ãƒ‰
  (global-set-key (kbd "C-c a") 'org-agenda)

  ;; org-agenda ã«èª­ã¿è¾¼ã¾ã›ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ OS ã«å¿œã˜ã¦åˆ‡ã‚Šæ›¿ãˆ
  ;; ã“ã“ã§ã¯ inbox.org ã®ã¿ã‚’å¯¾è±¡
  (setq org-agenda-files (list (if (eq system-type 'windows-nt)
				   "C:/emacs-org/inbox.org"
				 "~/.emacs.d/inbox.org")))

  ;; ---------------------------------------------------------
  ;; Org Agenda ã®è¡¨ç¤ºã«é–¢ã™ã‚‹ UI è¨­å®š
  ;; ---------------------------------------------------------

  ;; agenda ãƒãƒƒãƒ•ã‚¡ã§ç¾åœ¨è¡Œã‚’å¼·èª¿è¡¨ç¤ºï¼ˆè¡Œã®ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼‰
  (add-hook 'org-agenda-mode-hook '(lambda () (hl-line-mode 1)))

  ;; ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä¸‹ç·šã«
  (setq hl-line-face 'underline)


  ;; ---------------------------------------------------------
  ;; Org Agenda ã®ãƒ­ã‚°ãƒ»ã‚¯ãƒ­ãƒƒã‚¯æ©Ÿèƒ½
  ;; ---------------------------------------------------------
  ;; ã€Œãƒ­ã‚°ãƒ¢ãƒ¼ãƒ‰ã€ã«è¡¨ç¤ºã™ã‚‹å†…å®¹ã‚’æŒ‡å®šï¼ˆå®Œäº†æ™‚åˆ»ã¨ã‚¯ãƒ­ãƒƒã‚¯æ™‚é–“ï¼‰
  (setq org-agenda-log-mode-items '(closed clock))

  ;; agenda ã‚’é–‹ã„ãŸã¨ãã«ãƒ­ã‚°è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã‚’è‡ªå‹•ã§æœ‰åŠ¹åŒ–
  (setq org-agenda-start-with-log-mode t)

  ;; ã‚¯ãƒ­ãƒƒã‚¯ãƒ¬ãƒãƒ¼ãƒˆï¼ˆä½œæ¥­æ™‚é–“é›†è¨ˆï¼‰ã‚’ agenda å†…ã§è¡¨ç¤ºå¯èƒ½ã«ã™ã‚‹
  (setq org-agenda-clockreport-mode t) ;; org-agendaã§æ™‚è¨ˆãƒ¬ãƒãƒ¼ãƒˆã‚’æœ‰åŠ¹åŒ–


  ;; ---------------------------------------------------------
  ;; Org Agenda ã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰æ‹¡å¼µï¼ˆãƒ­ãƒ¼ãƒ‰å¾Œã«å®šç¾©ï¼‰
  ;; ---------------------------------------------------------
  ;; org-agenda ãƒ¢ãƒ¼ãƒ‰ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œã«ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã‚’å®šç¾©
  (eval-after-load 'org-agenda
    '(progn
       ;; `i`: ç¾åœ¨ã® agenda é …ç›®ã® clock-inï¼ˆä½œæ¥­é–‹å§‹ï¼‰
       (define-key org-agenda-mode-map "i" 'org-agenda-clock-in)

       ;; `o`: clock-outï¼ˆä½œæ¥­çµ‚äº†ï¼‰
       (define-key org-agenda-mode-map "o" 'org-agenda-clock-out)))
#+END_SRC

#+BEGIN_SRC emacs-lisp
  ;; ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ãŸæ™‚ã«è‡ªå‹•çš„ã«clock outã™ã‚‹
  (setq org-clock-out-when-done t)
#+END_SRC

** export
#+begin_src emacs-lisp
    ;; ------------------------------------------------------------
    ;; Org ã® ASCII / Markdown ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«é–¢ã™ã‚‹è¨­å®š
    ;; ------------------------------------------------------------

    ;; ASCII ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ™‚ã®è¦‹å‡ºã—å‰å¾Œã®ç©ºè¡Œã‚’å‰Šé™¤
    (setq org-ascii-headline-spacing '(0 . 0))

    ;; Org-mode èª­ã¿è¾¼ã¿å¾Œã« Markdown ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç”¨ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’èª­ã¿è¾¼ã‚€
    (eval-after-load "org"
      '(require 'ox-md nil t))


    ;; ------------------------------------------------------------
    ;; ç©ºè¡Œã‚’ã™ã¹ã¦å‰Šé™¤ã™ã‚‹é–¢æ•°ï¼ˆMarkdown æ›¸ãå‡ºã—å¾Œã®æ•´å½¢å‘ã‘ï¼‰
    ;; ------------------------------------------------------------
    ;; markdownã«å‡ºåŠ›ã—ãŸãƒãƒƒãƒ•ã‚¡ãƒ¼å†…ã§ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã‚‹
    (defun my/remove-blank-lines ()
      "Remove all blank lines in the current buffer."
      (interactive)
      (save-excursion
	(goto-char (point-min))
	(flush-lines "^[[:space:]]*$")))

    ;; C-c d ã§ç©ºè¡Œå‰Šé™¤ã‚’å®Ÿè¡Œ
    (global-set-key (kbd "C-c d") 'my/remove-blank-lines)

#+end_src
** task-time-calculate
#+begin_src emacs-lisp
  (defun my/org-add-node-link-property ()
    "ç¾åœ¨ã®ã‚¨ãƒ³ãƒˆãƒªã« 'node-link' ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã™ã‚‹ï¼ˆè¤‡æ•°ç™»éŒ²å¯ï¼‰ã€‚
    org-roam ã®ãƒãƒ¼ãƒ‰è£œå®Œã‚’ä½¿ã£ã¦ãƒªãƒ³ã‚¯ã‚’é¸ã¶ã€‚"
    (interactive)
    (require 'org-roam)
    (let* ((node (org-roam-node-read))
	   (id (org-roam-node-id node))
	   (title (org-roam-node-title node))
	   (link (org-link-make-string (concat "id:" id) title))
	   (current (org-entry-get nil "node-link")))
      (if current
	  (progn
	    (org-set-property "node-link" (concat current ", " link))
	    (message "ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ 'node-link' ã«ãƒªãƒ³ã‚¯ '%s' ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚" link))
	(org-set-property "node-link" link)
	(message "'node-link' ã‚’ '%s' ã«è¨­å®šã—ã¾ã—ãŸã€‚" link))))


  ;; ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã‚’è¨­å®š (org-modeã ã‘ã§æœ‰åŠ¹)
  (with-eval-after-load 'org
    (define-key org-mode-map (kbd "C-c C-x n") #'my/org-add-node-link-property ))




  ;; ------------------------------------------------------------
  ;; Effort ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§é¸ã¹ã‚‹æ™‚é–“ã‚’åˆ¶é™ã™ã‚‹
  ;; ------------------------------------------------------------
  (with-eval-after-load 'org
    ;; Effort_ALL ã«åˆ—æŒ™ã—ãŸå€¤ã ã‘ã‚’ C-c C-x e æ™‚ã«è£œå®Œ
    (setq org-global-properties
	  '(("Effort_ALL" . "0:05 0:10 0:15 0:30 0:45 1:00"))))


  (with-eval-after-load 'org
    ;; æ™‚é–“æ–‡å­—åˆ—â†’åˆ† ã«å¤‰æ›ã™ã‚‹ãŸã‚ã«å¿…è¦
    (require 'org-duration)

    ;; ------------------------------------------------------------
    ;; Effort è¨­å®šæ™‚ã«30åˆ†ä»¥ä¸Šãªã‚‰ã€Œbreak downã€ã‚’æ¨å¥¨ã™ã‚‹
    ;; ------------------------------------------------------------
    (defun my/org-check-effort-breakdown (&rest _args)
      "Effort ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®šã—ãŸå¾Œã«å‘¼ã°ã‚Œã€30åˆ†ä»¥ä¸Šãªã‚‰åˆ†å‰²ã‚’ä¿ƒã™ã€‚"
      (when-let* ((effort-str (org-entry-get nil "Effort"))
		  (min         (org-duration-to-minutes effort-str)))
	(when (>= min 30)
	  (message
	   "âš ï¸ Effort ãŒ %d åˆ†ã§ã™ã€‚ã‚¿ã‚¹ã‚¯ã‚’30åˆ†æœªæº€ã«åˆ†å‰²ï¼ˆbreak downï¼‰ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚"
	   min))))

    ;; org-set-effort å®Ÿè¡Œå¾Œã«ãƒã‚§ãƒƒã‚¯
    (advice-add 'org-set-effort :after #'my/org-check-effort-breakdown))


  (with-eval-after-load 'org
    (require 'org-duration)

    (defcustom my/org-effort-diff-threshold 10
      "Effort ã¨ CLOCK åˆè¨ˆã®å·®ãŒã“ã‚Œï¼ˆåˆ†ï¼‰ã‚’è¶…ãˆãŸã¨ãã«ç†ç”±ã‚’èãã€‚"
      :type 'integer)

    (defcustom my/org-effort-diff-property "WhyDiff"
      "å·®ç•°ã®ç†ç”±ã‚’è¨˜éŒ²ã™ã‚‹ PROPERTIES ã®ã‚­ãƒ¼ã€‚"
      :type 'string)

    ;; LOGBOOK å†…ã® CLOCK: è¡Œã‚’åˆè¨ˆã—ã¦åˆ†ã§è¿”ã™ãƒ˜ãƒ«ãƒ‘ãƒ¼
    (defun my/org-get-logbook-total-minutes ()
      "ç¾åœ¨ã®ã‚¨ãƒ³ãƒˆãƒªã®LOGBOOKå†…CLOCKåˆè¨ˆã‚’åˆ†å˜ä½ã§è¿”ã™ã€‚"
      (save-excursion
	(let* ((subtree-end (save-excursion (org-end-of-subtree t)))
	       (log-start
		(when (re-search-forward "^:LOGBOOK:" subtree-end t)
		  (forward-line 1) (point)))
	       (log-end
		(when log-start
		  (save-excursion
		    (goto-char log-start)
		    (re-search-forward "^:END:" subtree-end t)
		    (match-beginning 0))))
	       (sum 0))
	  (when (and log-start log-end)
	    (goto-char log-start)
	    (while (re-search-forward
		    "^CLOCK:.*=>[ \t]*\\([0-9]+\\):\\([0-9]+\\)"
		    log-end t)
	      (let ((h (string-to-number (match-string 1)))
		    (m (string-to-number (match-string 2))))
		(setq sum (+ sum (+ (* 60 h) m))))))
	  sum)))

    ;; Effort vs CLOCK å·®ç•°ãƒã‚§ãƒƒã‚¯æœ¬ä½“
    (defun my/org-check-effort-diff ()
      "TODOâ†’DONE æ™‚ã« Effort ã¨ CLOCK åˆè¨ˆã‚’æ¯”è¼ƒã—ã€å·®ãŒå¤§ãã‘ã‚Œã°ç†ç”±ã‚’è¨˜éŒ²ã€‚"
      (when (and (string= org-state "DONE")
		 (org-entry-get nil "Effort"))
	(let* ((effort-min (org-duration-to-minutes (org-entry-get nil "Effort")))
	       (total-min  (my/org-get-logbook-total-minutes))
	       (diff       (- total-min effort-min)))
	  (message "[EffortDiff] effort=%d åˆ†, total=%d åˆ†, diff=%+d åˆ†"
		   effort-min total-min diff)
	  (when (> (abs diff) my/org-effort-diff-threshold)
	    (let ((reason
		   (read-string
		    (format "effort:%dåˆ†, total:%dåˆ†, diff:%+dåˆ† Why?: "
			    effort-min total-min diff my/org-effort-diff-threshold))))
	      (org-entry-put nil my/org-effort-diff-property reason))))))

    ;; DONE ã¸ã®çŠ¶æ…‹å¤‰æ›´å¾Œã«ãƒ•ãƒƒã‚¯ç™»éŒ²
    (add-hook 'org-after-todo-state-change-hook #'my/org-check-effort-diff))

(defun my-clocktable-write-reorder (&rest args)
  "Org clocktable ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºåŠ›ã—ãŸã‚ã¨ã€
åˆ—ã‚’ Headline | Effort | Time | â€¦ | % | WhyDiff ã®é †ã«ä¸¦ã¹æ›¿ãˆã‚‹ã€‚"
  ;; 1) ã¾ãšã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¡¨ã‚’æ›¸ãå‡ºã™
  (apply #'org-clocktable-write-default args)

  ;; 2) ãã®å¾Œã€å‡ºåŠ›ã•ã‚ŒãŸãƒãƒƒãƒ•ã‚¡ä¸Šã§åˆ—ã‚’å…¥ã‚Œæ›¿ãˆã‚‹
  (save-excursion
    (goto-char (point-min))
    ;; â”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã®ã€ŒEffortã€ãŒã‚ã‚‹è¡Œã‚’æ¤œç´¢
    (when (re-search-forward "^| *Effort *|" nil t)
      (beginning-of-line)

      ;; (a) Effort(1åˆ—ç›®) ã‚’ Headline(3åˆ—ç›®) ã®å¾Œã‚ã¸ç§»å‹•
      (dotimes (_ 2)
        (org-table-move-column-right))

      ;; (b) æ®‹ã£ãŸæœ€å·¦åˆ—ï¼ˆå…ƒ WhyDiffï¼‰ã‚’æœ«å°¾ã¸ç§»å‹•
      (let* ((line  (buffer-substring (line-beginning-position)
                                      (line-end-position)))
             ;; "|" ã§åˆ†å‰² â†’ ã‚»ãƒ«æ•°ã‚’æ•°ãˆã‚‹
             (cols  (length (split-string line "|" t)))
             ;; ç¾åœ¨ã¯1åˆ—ç›®ãªã®ã§ã€æœ«å°¾ã¾ã§å‹•ã‹ã™å›æ•° = colsâˆ’1
             (moves (1- cols)))
        (org-table-goto-column 1)
        (dotimes (_ moves)
          (org-table-move-column-right))))))

#+end_src
* appearance
** theme
  #+BEGIN_SRC emacs-lisp
    ;; ----------------------------------------------------------
    ;; Doom Themes ã®è¨­å®š
    ;; ----------------------------------------------------------
    (use-package doom-themes
      ;; Italic / Bold ã‚’ãƒ†ãƒ¼ãƒå†…ã§æœ‰åŠ¹ã«ã™ã‚‹
      :custom
      (doom-themes-enable-italic t)
      (doom-themes-enable-bold t)

      ;; ãƒ¢ãƒ¼ãƒ‰ãƒ©ã‚¤ãƒ³ã®ãƒãƒ¼ã®è‰²ã‚’ã‚«ã‚¹ã‚¿ãƒ è¨­å®š
      :custom-face
      (doom-modeline-bar ((t (:background "#6272a4"))))

      ;; ãƒ†ãƒ¼ãƒã‚’èª­ã¿è¾¼ã‚€ï¼ˆt ã‚’æ¸¡ã™ã¨ç¢ºèªãªã—ã§å³æ™‚é©ç”¨ï¼‰
      :config
      (load-theme 'doom-badger t)

      ;; Neotreeï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ„ãƒªãƒ¼ï¼‰ã®é…è‰²ã‚’ Doom ä»•æ§˜ã«
      (doom-themes-neotree-config)

      ;; Org-mode ç”¨ã®è‰²è¨­å®šã‚’æœ‰åŠ¹ã«ã™ã‚‹
      (doom-themes-org-config))

    ;; ----------------------------------------------------------
    ;; Doom Modelineï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³ï¼‰ã®è¨­å®š
    ;; ----------------------------------------------------------
    (use-package doom-modeline
      :custom
      ;; ãƒ•ã‚¡ã‚¤ãƒ«åè¡¨ç¤ºå½¢å¼ï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰ã®ç›¸å¯¾ãƒ‘ã‚¹
      (doom-modeline-buffer-file-name-style 'truncate-with-project)

      ;; ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤ºã‚’æœ‰åŠ¹ã«ã™ã‚‹ï¼ˆãƒ•ã‚©ãƒ³ãƒˆãŒå¿…è¦ï¼‰
      (doom-modeline-icon t)

      ;; ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã®ã‚¢ã‚¤ã‚³ãƒ³ã¯éè¡¨ç¤º
      (doom-modeline-major-mode-icon nil)

      ;; ãƒã‚¤ãƒŠãƒ¼ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºã‚’éè¡¨ç¤ºã«ã—ã¦ç°¡æ½”åŒ–
      (doom-modeline-minor-modes nil)

      :hook
      ;; Emacs åˆæœŸåŒ–å¾Œã«è‡ªå‹•ã§ doom-modeline ã‚’æœ‰åŠ¹åŒ–
      (after-init . doom-modeline-mode)

      :config
      ;; ãƒ¢ãƒ¼ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰è¡Œç•ªå·ãƒ»åˆ—ç•ªå·è¡¨ç¤ºã‚’å‰Šé™¤ï¼ˆè¦‹ãŸç›®ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ï¼‰
      (line-number-mode 0)
      (column-number-mode 0))

    ;; -------------------------------------------------------------
    ;; ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æƒ…å ±ã®è¨­å®š
    ;; -------------------------------------------------------------
    (custom-set-variables
     '(custom-safe-themes
       '("b5fd9c7429d52190235f2383e47d340d7ff769f141cd8f9e7a4629a81abc6b19" default))
     '(package-selected-packages '(org doom-modeline doom-themes listen)))

    ;; ----------------------------------------------------------
    ;; GUIã®ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã‚’éè¡¨ç¤ºã«ã—ã¦ç”»é¢ã‚’åºƒãä½¿ã†
    ;; ----------------------------------------------------------
    (tool-bar-mode -1)
  #+END_SRC
** window transparency
#+begin_src emacs-lisp
  ;; -------------------------------------------------------------
  ;; ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®é€éè¨­å®šï¼ˆforeground 90%, background 80%ï¼‰
  ;; -------------------------------------------------------------
  (set-frame-parameter nil 'alpha '(95 . 80))
  (add-to-list 'default-frame-alist '(alpha . (95 . 80)))
#+end_src
* custom command
  #+BEGIN_SRC emacs-lisp
    (defun my/org-insert-sections (start end levels prefix char)
      "Insert sections from START to END with LEVELS characters (CHAR) and PREFIX.
    If PREFIX is empty, show a message and do nothing."
      (interactive
       (list (read-number "Start number: " 0)
	     (read-number "End number: " 9)
	     (read-number "Levels (number of characters): " 2)
	     (read-string "Prefix: ")
	     (read-char-choice "Choose character (*, -, +): " '(?* ?- ?+))))
      (if (string-empty-p prefix)
	  (message "Please enter a prefix.")
	(dotimes (i (1+ (- end start)))
	  (insert (format "%s %s %d\n" (make-string levels char) prefix (+ start i))))))

    (global-set-key (kbd "C-c i") 'my/org-insert-sections)

  #+END_SRC

  #+BEGIN_SRC emacs-lisp
    (global-set-key (kbd "C-c n u") 'org-roam-ui-mode)


     (defun check-org-properties-block-recursively ()
       "Check if the .org files in the org-roam-directory and its subdirectories contain the required :PROPERTIES: block."
       (interactive)
       (let* ((directory (file-name-as-directory org-roam-directory))
	      (total-files 0)
	      (ok-files 0)
	      (ng-files 0)
	      (ng-files-list '()))
	 (dolist (file (directory-files-recursively directory "\\.org$"))
	   (setq total-files (1+ total-files))
	   (with-temp-buffer
	     (insert-file-contents file)
	     (goto-char (point-min))
	     (if (and (re-search-forward ":PROPERTIES:" nil t)
		      (re-search-forward ":ID:" nil t)
		      (re-search-forward ":END:" nil t))
		 (setq ok-files (1+ ok-files))
	       (setq ng-files (1+ ng-files))
	       (push file ng-files-list))))
	 ;; çµæœã‚’è¡¨ç¤º
	 (message "Total files: %d" total-files)
	 (message "OK files: %d" ok-files)
	 (message "NG files: %d" ng-files)
	 (when ng-files-list
	   (message "NG files list:")
	   (dolist (file ng-files-list)
	     (message "%s" file)))))

     ;; é–¢æ•°ã‚’ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹ãŸã‚ã®è¨­å®š
     (provide 'check-org-properties-block-recursively)
  #+END_SRC
** neotree
** keybinding
- n next line, p previous lineã€‚
- SPC or RET or TAB Open current item if it is a file. Fold/Unfold current item if it is a directory.
- U Go up a directory
- g Refresh
- A Maximize/Minimize the NeoTree Window
- H Toggle display hidden files
- O Recursively open a directory
- C-c C-n Create a file or create a directory if filename ends with a â€˜/â€™
- C-c C-d Delete a file or a directory.
- C-c C-r Rename a file or a directory.
- C-c C-c Change the root directory.
- C-c C-p Copy a file or a directory.
** config
#+begin_src emacs-lisp
  ;; neotreeã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®š
  (use-package neotree
    :ensure t
    :config
    ;; èµ·å‹•æ™‚ã«neotreeã‚’é–‹ãã‚­ãƒ¼ã‚’è¨­å®š
    (global-set-key [f8] 'neotree-toggle)
    ;; neotreeã®ãƒ†ãƒ¼ãƒã‚’è¨­å®š
    (setq neo-theme (if (display-graphic-p) 'icons 'arrow))
    ;; ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒæ›´æ–°ã•ã‚ŒãŸã‚‰è‡ªå‹•ã§neotreeã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
    (add-hook 'neo-after-create-hook
	      (lambda (_)
		(with-current-buffer (get-buffer neo-buffer-name)
		  (setq truncate-lines t)
		  (setq word-wrap nil)))))

  ;; all-the-iconsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®š
  (use-package all-the-icons
    :ensure t)

#+end_src

* org-ai
#+begin_src emacs-lisp
  ;; secrets.elã‚’èª­ã¿è¾¼ã‚€
  (let ((secrets-file
	 (if (eq system-type 'windows-nt)
	     "C:/emacs-org/config/secrets.el" ;; Windowsã®ãƒ‘ã‚¹
	   "~/.emacs.d/config/secrets.el"))) ;; Macã‚„Linuxã®ãƒ‘ã‚¹
    (when (file-exists-p secrets-file)
      (load secrets-file)))

  ;; org-aiã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®š
  (use-package org-ai
    :ensure t
    :commands (org-ai-mode
	       org-ai-global-mode)
    :init
    ;; Org-mode ãƒãƒƒãƒ•ã‚¡ã«å…¥ã£ãŸæ™‚ã€è‡ªå‹•ã§ org-ai-mode ã‚’æœ‰åŠ¹åŒ–
    (add-hook 'org-mode-hook #'org-ai-mode) ; enable org-ai in org-mode

    ;; ã‚°ãƒ­ãƒ¼ãƒãƒ«ã« org-ai ã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ï¼ˆC-c M-aï¼‰ã‚’æœ‰åŠ¹åŒ–
    (org-ai-global-mode) ; installs global keybindings on C-c M-a

    :config
    ;; OpenAI ãƒ¢ãƒ‡ãƒ«ã‚’æŒ‡å®š
    (setq org-ai-default-chat-model "gpt-4.1-mini") ; if you are on the gpt-4 beta:

    ;; yasnippet ç”¨ã® AI ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’èª­ã¿è¾¼ã‚€ï¼ˆ`ai` ã¨ã„ã†å±•é–‹è£œåŠ©ï¼‰
    (org-ai-install-yasnippets)) ; if you are using yasnippet and want `ai` snippets

  ;; ç’°å¢ƒå¤‰æ•°ã‹ã‚‰APIã‚­ãƒ¼ã‚’å–å¾—ã™ã‚‹
  (setq org-ai-openai-api-token org-ai-api-key)


  ;; ----------------------------------------------------------
  ;; Org-mode ã® <ai + TAB ã«å¯¾å¿œã™ã‚‹æ§‹æ–‡ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’è¿½åŠ 
  ;; ----------------------------------------------------------
  (with-eval-after-load 'org
    (add-to-list 'org-structure-template-alist
		 ;; <ai + tab --> #+begin_ai
		 '("ai" . "ai")))
#+end_src

* vertico.el
#+begin_src emacs-lisp
(require 'package)
(setq package-archives
      '(("melpa" . "https://melpa.org/packages/")
        ("gnu"   . "https://elpa.gnu.org/packages/")))

(unless package-archive-contents
  (package-refresh-contents))

;; å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹é–¢æ•°
(defvar my-required-packages
  '(vertico marginalia orderless consult embark embark-consult savehist)
  "List of packages to ensure are installed at launch.")

(unless package-archive-contents
  (package-refresh-contents))

(dolist (pkg my-required-packages)
  (unless (package-installed-p pkg)
    (package-install pkg)))

;; è£œå®Œã‚¹ã‚¿ã‚¤ãƒ«ã«orderlessã‚’åˆ©ç”¨ã™ã‚‹
(with-eval-after-load 'orderless
  (setq completion-styles '(orderless)))

;; è£œå®Œå€™è£œã‚’æœ€å¤§20è¡Œã¾ã§è¡¨ç¤ºã™ã‚‹
(setq vertico-count 20)

;; vertico-modeã¨marginalia-modeã‚’æœ‰åŠ¹åŒ–ã™ã‚‹
(defun my/enable-completion-enhancements ()
  (vertico-mode)
  ;; savehist-modeã‚’ä½¿ã£ã¦Verticoã®é †ç•ªã‚’æ°¸ç¶šåŒ–ã™ã‚‹
  (savehist-mode))
(add-hook 'after-init-hook #'my/enable-completion-enhancements)

;; Marginaliaã®è¨­å®š
;; Enable rich annotations using the Marginalia package
(use-package marginalia
  ;; Bind `marginalia-cycle' locally in the minibuffer.  To make the binding
  ;; available in the *Completions* buffer, add it to the
  ;; `completion-list-mode-map'.
  :bind (:map minibuffer-local-map
         ("M-A" . marginalia-cycle))

  ;; The :init section is always executed.
  :init

  ;; Marginalia must be activated in the :init section of use-package such that
  ;; the mode gets enabled right away. Note that this forces loading the
  ;; package.
  (marginalia-mode))

;; embark-consultã‚’èª­ã¿è¾¼ã‚€
(with-eval-after-load 'consult
  (with-eval-after-load 'embark
    (require 'embark-consult)))

;; orderlessã®è¨­å®š
(use-package orderless
  :ensure t
  :custom
  (completion-styles '(orderless basic))
  (completion-category-overrides '((file (styles basic partial-completion)))))

(require 'orderless)
(setq completion-styles '(orderless basic)
      completion-category-overrides '((file (styles basic partial-completion))))

#+END_SRC

#+begin_src emacs-lisp
    (defvar my/fibonacci-points '(1 2 3 5 8 13 21 34 55 89))

    (defun my/org-set-story-point ()
      "Prompt for storypoint from Fibonacci values and set it as a property."
      (interactive)
      (let* ((choices (mapcar #'number-to-string my/fibonacci-points))
	     (choice (completing-read "Storypoint: " choices nil t)))
	(org-set-property "Storypoint" choice)))

    (defun my/org--get-storypoint ()
      "Get storypoint as number, or nil if not set or invalid."
      (let ((val (org-entry-get (point) "Storypoint")))
	(when (and val (string-match-p "^[0-9]+$" val))
	  (string-to-number val))))

    (defun my/org--get-effort-from-point (base-point base-minutes)
      "Compute effort string like 0:05 for a given point and base."
      (let ((total (* base-minutes base-point)))
	(format "%d:%02d" (/ total 60) (% total 60))))

(defun my/org-assign-efforts-based-on-storypoints (start end)
  "Assign Effort properties to child tasks based on storypoints.
Also set total Effort and Storypoint on the top-level heading (excluding itself from aggregation)."
  (interactive "r")
  (let ((entries '())
        (min-point most-positive-fixnum)
        (total-storypoints 0)
        (parent-marker (save-excursion
                         (goto-char start)
                         (org-back-to-heading t)
                         (point-marker)))) ;; è¦ªè¦‹å‡ºã—ã®ä½ç½®ã‚’è¨˜éŒ²

    ;; collect all storypoints from children (excluding parent)
    (save-excursion
      (goto-char start)
      (while (re-search-forward org-heading-regexp end t)
        (save-excursion
          (org-back-to-heading t)
          (let ((pos (point)))
            (unless (= pos (marker-position parent-marker)) ;; è¦ªã‚’é™¤å¤–
              (let ((point-val (my/org--get-storypoint)))
                (when point-val
                  (push (cons (point-marker) point-val) entries)
                  (setq min-point (min min-point point-val))
                  (setq total-storypoints (+ total-storypoints point-val)))))))))

    (if (null entries)
        (message "No child tasks with Storypoint found.")
      (let* ((time-options '("0:01" "0:03" "0:05" "0:10" "0:15" "0:30" "0:45" "1:00"))
             (base-choice (completing-read
                           (format "Time for Storypoint %d (min): " min-point)
                           time-options nil t))
             (base-minutes (let* ((parts (split-string base-choice ":"))
                                  (h (string-to-number (car parts)))
                                  (m (string-to-number (cadr parts))))
                             (+ (* h 60) m)))
             (total-effort-minutes 0))
        ;; assign Effort properties to each child
        (dolist (entry entries)
          (let ((marker (car entry))
                (point-val (cdr entry)))
            (with-current-buffer (marker-buffer marker)
              (goto-char marker)
              (let ((effort (my/org--get-effort-from-point point-val base-minutes)))
                (org-set-property "Effort" effort)
                (let* ((parts (split-string effort ":"))
                       (effort-min (+ (* 60 (string-to-number (car parts)))
                                      (string-to-number (cadr parts)))))
                  (setq total-effort-minutes (+ total-effort-minutes effort-min)))))))

        ;; è¦ªã«åˆè¨ˆã‚’ã‚»ãƒƒãƒˆï¼ˆè‡ªåˆ†è‡ªèº«ã®æ—¢å­˜å€¤ã¯ç„¡è¦–ï¼‰
        (with-current-buffer (marker-buffer parent-marker)
          (goto-char parent-marker)
          (let ((total (format "%d:%02d" (/ total-effort-minutes 60) (% total-effort-minutes 60))))
            (org-set-property "Effort" total)
            (org-set-property "Storypoint" (number-to-string total-storypoints))
            (message "Total effort: %s, Total storypoints: %d" total total-storypoints)))))))



    ;; ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰
    (define-key org-mode-map (kbd "C-c C-x C-s") #'my/org-set-story-point)
    (define-key org-mode-map (kbd "C-c C-x C-d") #'my/org-assign-efforts-based-on-storypoints)


#+end_src

#+begin_src emacs-lisp

#+end_src
